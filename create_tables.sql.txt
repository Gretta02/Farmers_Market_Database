CREATE TABLE VENDORS (
    vendor_id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    contact VARCHAR(50),
    stall_number VARCHAR(10) NOT NULL
);

CREATE TABLE PRODUCTS (
    product_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    category VARCHAR(50),
    price DECIMAL(10, 2) CHECK (price >= 0),
    quantity INT NOT NULL CHECK (quantity >= 0),
    vendor_id INT,
    discount_percentage DECIMAL(5,2) DEFAULT 0,
    min_stock_level INT DEFAULT 10,
    max_stock_level INT DEFAULT 100,
    created_at DATE DEFAULT SYSDATE,
    CONSTRAINT chk_discount CHECK (discount_percentage BETWEEN 0 AND 100),
    FOREIGN KEY (vendor_id) REFERENCES VENDORS(vendor_id)
);

CREATE TABLE SALES (
    sale_id INT PRIMARY KEY,
    product_id INT,
    vendor_id INT,
    quantity_sold INT NOT NULL CHECK (quantity_sold > 0),
    price DECIMAL(10, 2) CHECK (price >= 0),
    sale_date DATE,
    transaction_id VARCHAR2(50),
    payment_method VARCHAR2(20),
    customer_feedback VARCHAR2(1000),
    FOREIGN KEY (product_id) REFERENCES PRODUCTS(product_id),
    FOREIGN KEY (vendor_id) REFERENCES VENDORS(vendor_id)
);

CREATE TABLE HOLIDAYS (
    holiday_date DATE PRIMARY KEY,
    description VARCHAR2(100)
);

CREATE TABLE AUDIT_LOG (
    audit_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id VARCHAR2(100),
    action_date TIMESTAMP DEFAULT SYSTIMESTAMP,
    operation VARCHAR2(20),
    table_name VARCHAR2(30),
    status VARCHAR2(20),
    description VARCHAR2(4000)
);

CREATE INDEX idx_product_category ON PRODUCTS(category);